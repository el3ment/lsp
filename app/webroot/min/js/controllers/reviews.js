(function(){define(["utilities/global","controllers/application","vendors/form2js/form2js","models/api","models/netsuite"],function(){var e=window.LSP.utilities;e.register("controller","reviews",function(){var t={},n=window.LSP,r=n.models.netsuite,i={containerSelector:"#addReviewForm",formSelector:"#reviews-inputForm",prosInputSelector:"#reviews-inputForm .pros input",consInputSelector:"#reviews-inputForm .cons input",reviewTemplateId:"templates-reviewEntry",previewSelector:"#previewReview"};return t={name:"reviews",events:{reviews:{onAfterAPICallSuccess:function(e,t){$(i.formSelector).removeClass("loading"),$("#reviewEntries").removeClass("loading secondary"),$('button.b1.reveal-open[data-reveal-children*="addReviewForm"]').trigger("click"),$(":input",i.formSelector).removeAttr("disabled")},onBeforeAPICall:function(e,t){$(i.formSelector).addClass("loading"),$("#reviewEntries").addClass("loading secondary"),$(":input",i.formSelector).attr("disabled")},onSave:function(e,r){var i=r.selector[0];n.controllers.validation.validateForm(i)&&t.save(t.parseForm(i))},onProOrConInput:function(e){e.currentTarget.value.length>0?$(e.currentTarget).parent().next().show():$(e.currentTarget).parent().next().length&&($(e.currentTarget).parent().next().children("input").val()||"").length<1?$(e.currentTarget).parent().next().hide():!$(e.currentTarget).is(":focus")&&!$(e.currentTarget).parent().is(":nth-of-type(1)")&&$(e.currentTarget).parent().prev().children().val().length<1&&$(e.currentTarget).parent().hide()},onRenderPreview:function(e){$(i.previewSelector).html(t.render(t.parseForm(e.currentTarget.form)))}},application:{onAttachEvents:function(e,n){$(i.formSelector+" :input",n.selector).off("reviews").on("keyup.lsp.reviews change.lsp.reviews",t.events.reviews.onRenderPreview).filter('input[type="checkbox"], input[type="radio"], select').on("click.lsp.reviews change.lsp.reviews",t.events.reviews.onRenderPreview),$(i.prosInputSelector+", "+i.consInputSelector,n.selector).off("reviews").on("keyup.lsp.reviews change.lsp.reviews",t.events.reviews.onProOrConInput)}}},assets:{},save:function(e){return _gaq.push(["_trackEvent","reviews","saveReview"]),r.request(t,"saveReview",{method:"saveReview",data:JSON.stringify(e)}).done(function(n){t.renderSavedReview(e)})},render:function(t){var n=e.parseMicroTemplate(i.reviewTemplateId,t);return n},renderSavedReview:function(t){e.scrollTo($(".reviews.section")),$("ul.entries").addClass("saved")},parseForm:function(t){var n,r=[];n=e.formToObject(t,null,!0);for(var i=0;i<((n||{}).custrecordreviewprofile||{}).length;i++)if(n.custrecordreviewprofile[i].title){var s="";if(n.custrecordreviewprofile[i].time>0){var o=n.custrecordreviewprofile[i].time>1?"s":"";s="&nbsp;("+n.custrecordreviewprofile[i].time+"&nbsp;yr"+o+")"}r.push(n.custrecordreviewprofile[i].title+s)}return n.profile=r.join(", "),n}},t}())})})();