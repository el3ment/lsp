(function(){define(["utilities/global","controllers/application"],function(){var e=window.LSP.utilities,t=function(){var t={},n=window.LSP,r=n.models.netsuite,i={sluglessSelector:"*[data-def]:not([data-definitions-slug]):not([data-definitions-definition])",definitionlessSelector:"*[data-def][data-definitions-slug]:not([data-definitions-definition])",parsedSelector:"*[data-def][data-definitions-definition]"};return t={name:"definitions",events:{definitions:{onAfterAPICallFailure:function(e,t){$("*[data-def]").removeAttr("data-def")}},application:{onAttachEvents:function(e,n){var r=[];$(i.sluglessSelector,n.selector).each(function(e,n){$(this).attr("data-definitions-slug",t.makeSlug($(this).html()))}),$(i.definitionlessSelector,n.selector).each(function(e,t){r.push($(this).attr("data-definitions-slug"))}),$.when(t.getDefinitions(r)).done(function(e){e&&e.response&&e.response.data&&t.parseDefinitions(e.response.data,n.selector)})}}},assets:{},getDefinitions:function(e){if(e.length>0)return r.request(t,"getDefinitions",{method:"getDefinitions",slugs:JSON.stringify(e)})},parseDefinitions:function(n,r){$(i.definitionlessSelector,r).each(function(r,i){for(var s=0;s<n.length;s++)if(n[s].custrecordslug===$(this).data("definitions-slug")){var o=$(this);o.attr("data-definitions-title",n[s].name).attr("data-definitions-definition",n[s].custrecorddefinition).attr("data-definitions-url",n[s].custrecordurl).attr("data-definitions-imageurl",n[s].custrecordimageurl),o.append(e.parseMicroTemplate("templates-definitons-display",o.data())),o.bind("mouseenter",function(){t.showDefinition(this)}).bind("mouseleave",function(){t.hideDefinition(this)}).bind("click",function(){t.toggleDefinition(this)})}})},hideDefinition:function(e){$(".panel",e).hide()},showDefinition:function(e){$(".panel",e).show()},toggleDefinition:function(e){$(".panel",e).is(":visible")?$(".panel",e).hide():$(".panel",e).show()},makeSlug:function(e){return e.toLowerCase().replace(/[ ]+/g,"-").replace(/[^\w\-]/g,"")}},t}();e.register("controller","definitions",t)})})();